openapi: 3.0.0
info:
  title: MyShop Catalogue Service API
  description: |
    Complete REST API for Shop and Catalog management with authentication, QR code generation, and menu access.
    
    **Authentication Flow:**
    1. Create user account: `POST /api/shops/user`
    2. Login: `POST /api/shops/auth` (returns both private and public tokens)
    3. Private OAuth Token (90 days): Use for protected CRUD operations
    4. Public Access Token (7 days): Use for public API access (frontend)
    
    **Public Endpoints** (No authentication required):
    - `POST /api/shops/user` - Create shop user
    - `POST /api/shops/auth` - Login and get tokens
    - `POST /api/shops/reset-password` - Reset password
    - `GET /api/shops` - List all shops
    - `GET /api/shops/{id}` - Get shop details
    - `GET /api/shops/{id}/menus` - Get shop menu with today's catalog
    - `GET /api/catalogs/search/shop/{shopId}` - Get catalogs by shop
    
    **Protected Endpoints** (Requires Private OAuth Token):
    - POST/PUT/DELETE operations on shops and catalogs
    - Must include: `Authorization: Bearer {privateToken}`
  version: 2.0.0
  contact:
    name: MyShop API Team
    url: https://api.soanch.com
    email: support@soanch.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://api.soanch.com
    description: Production Server
  - url: http://localhost:8080
    description: Local Development Server

tags:
  - name: Shop
    description: Shop CRUD operations and management
  - name: Shop-Auth
    description: Shop user authentication, registration, and password management
  - name: Shop-Menu
    description: Shop menu access and catalog retrieval
  - name: Shop-QR
    description: QR code generation and retrieval for shops
  - name: Catalog
    description: Catalog item management and search

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Private OAuth Token (90 days) - Use for protected operations

  schemas:
    Shop:
      type: object
      properties:
        id:
          type: string
          example: "6958fbaac7c72a28f87b07ef"
        name:
          type: string
          example: "Pizza Palace"
        address:
          type: string
          example: "123 Main St, New York, NY"
        owner:
          type: string
          example: "John Doe"
        email:
          type: string
          example: "shop@pizzapalace.com"
        mobileCountryCode:
          type: string
          example: "91"
        mobileNumber:
          type: string
          example: "9876543210"
        theme:
          type: object
          properties:
            colors:
              type: object
              properties:
                primary:
                  type: string
                  example: "#FF6B6B"
                secondary:
                  type: string
                  example: "#FFFFFF"
            menu:
              type: string
              example: "Italian pizza, pasta, and desserts"
            lookAndFeel:
              type: string
              example: "Modern and cozy Italian restaurant"
            logo:
              type: string
              example: "pizza-icon.png"
        qr_code:
          type: string
          description: Base64 encoded QR code image
        qr_code_url:
          type: string
          example: "https://myshop.soanch.com/web-menu?shopid=6958fbaac7c72a28f87b07ef"

    ShopCreate:
      type: object
      required:
        - name
        - address
        - owner
        - email
        - mobileCountryCode
        - mobileNumber
        - theme
      properties:
        name:
          type: string
        address:
          type: string
        owner:
          type: string
        email:
          type: string
        mobileCountryCode:
          type: string
        mobileNumber:
          type: string
        theme:
          type: object

    Catalog:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        shopId:
          type: string
        unit:
          type: string
        price:
          type: object
          properties:
            currency:
              type: string
            value:
              type: number
        availability:
          type: object
          properties:
            startTime:
              type: string
              format: time
            endTime:
              type: string
              format: time
            available:
              type: boolean

    CreateUserRequest:
      type: object
      required:
        - shopId
        - password
        - confirmPassword
      properties:
        shopId:
          type: string
          example: "6958fbaac7c72a28f87b07ef"
        password:
          type: string
          format: password
          example: "SecurePassword123!"
        confirmPassword:
          type: string
          format: password
          example: "SecurePassword123!"

    AuthRequest:
      type: object
      required:
        - userId
        - password
      properties:
        userId:
          type: string
          description: "Either mobile number (countryCode+mobile) or shop email"
          example: "919876543210 or shop@example.com"
        password:
          type: string
          format: password
          example: "SecurePassword123!"

    AuthResponse:
      type: object
      properties:
        status:
          type: string
          example: "success"
        message:
          type: string
          example: "Authentication successful"
        oauthToken:
          type: string
          description: "Private OAuth Token (90 days) - Use for protected operations"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        publicAccessToken:
          type: string
          description: "Public Access Token (7 days) - Use for public API access from frontend"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        shopId:
          type: string
          example: "6958fbaac7c72a28f87b07ef"
        userId:
          type: string
          example: "919876543210"
        expiresInDays:
          type: integer
          example: 90
        publicTokenExpiresInDays:
          type: integer
          example: 7

    ResetPasswordRequest:
      type: object
      required:
        - userId
        - oldPassword
        - newPassword
        - confirmNewPassword
      properties:
        userId:
          type: string
          example: "919876543210"
        oldPassword:
          type: string
          format: password
        newPassword:
          type: string
          format: password
        confirmNewPassword:
          type: string
          format: password

    ShopMenuDTO:
      type: object
      properties:
        shopId:
          type: string
        shopName:
          type: string
        location:
          type: string
        catalogs:
          type: array
          items:
            $ref: '#/components/schemas/Catalog'

    Error:
      type: object
      properties:
        status:
          type: string
          example: "error"
        message:
          type: string
          example: "Error message"
        details:
          type: string

paths:
  /api/shops/user:
    post:
      tags:
        - Shop-Auth
      summary: Create a new shop user account
      description: |
        Create a new user account for a shop. 
        User ID is automatically set to the mobile number (countryCode + mobileNumber) from the shop.
        Password is hashed using BCrypt.
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            example:
              shopId: "6958fbaac7c72a28f87b07ef"
              password: "SecurePassword123!"
              confirmPassword: "SecurePassword123!"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "User created successfully"
                  userId:
                    type: string
                    example: "919876543210"
                  shopId:
                    type: string
                  createdAt:
                    type: string
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops/auth:
    post:
      tags:
        - Shop-Auth
      summary: Authenticate and get tokens
      description: |
        Authenticate user and receive both tokens:
        - **Private OAuth Token** (90 days): For protected backend operations
        - **Public Access Token** (7 days): For public API access from frontend
        
        UserId can be either:
        - Mobile number: countryCode + mobileNumber (e.g., 919876543210)
        - Email address (e.g., shop@example.com)
      operationId: authenticate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
            examples:
              mobileAuth:
                summary: Login with mobile number
                value:
                  userId: "919876543210"
                  password: "SecurePassword123!"
              emailAuth:
                summary: Login with email
                value:
                  userId: "shop@pizzapalace.com"
                  password: "SecurePassword123!"
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                status: "success"
                message: "Authentication successful"
                oauthToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                publicAccessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                shopId: "6958fbaac7c72a28f87b07ef"
                userId: "919876543210"
                expiresInDays: 90
                publicTokenExpiresInDays: 7
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                status: "error"
                message: "Invalid credentials"

  /api/shops/reset-password:
    post:
      tags:
        - Shop-Auth
      summary: Reset user password
      description: |
        Reset user password. Must provide old password for verification.
        UserId can be either mobile number or email.
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Password reset successfully"
        '400':
          description: Invalid request or old password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops:
    post:
      tags:
        - Shop
      summary: Create a new shop
      description: Creates a new shop with theme configuration (Requires Private Token)
      security:
        - BearerAuth: []
      operationId: createShop
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShopCreate'
            example:
              name: "Pizza Palace"
              address: "123 Main St, New York, NY"
              owner: "John Doe"
              email: "shop@pizzapalace.com"
              mobileCountryCode: "91"
              mobileNumber: "9876543210"
              theme:
                colors:
                  primary: "#FF6B6B"
                  secondary: "#FFFFFF"
                menu: "Italian pizza, pasta, and desserts"
                lookAndFeel: "Modern and cozy Italian restaurant"
                logo: "pizza-icon.png"
      responses:
        '201':
          description: Shop created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Shop'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - Shop
      summary: Get all shops
      description: Retrieve all shops from the database (Public endpoint)
      operationId: getAllShops
      responses:
        '200':
          description: List of all shops
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Shop'

    delete:
      tags:
        - Shop
      summary: Delete all shops
      description: Delete all shops from the database (Requires Private Token - Admin use only)
      security:
        - BearerAuth: []
      operationId: deleteAllShops
      responses:
        '204':
          description: All shops deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops/{id}:
    get:
      tags:
        - Shop
      summary: Get shop details
      description: Retrieve a shop by ID (Public endpoint)
      operationId: getShopById
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          example: "6958fbaac7c72a28f87b07ef"
      responses:
        '200':
          description: Shop found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Shop'
        '404':
          description: Shop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Shop
      summary: Update a shop
      description: Update shop details (Requires Private Token)
      security:
        - BearerAuth: []
      operationId: updateShop
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Shop'
      responses:
        '200':
          description: Shop updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Shop'
        '404':
          description: Shop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Shop
      summary: Delete a shop
      description: Delete a shop by ID (Requires Private Token)
      security:
        - BearerAuth: []
      operationId: deleteShop
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Shop deleted successfully
        '404':
          description: Shop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops/{id}/menus:
    get:
      tags:
        - Shop-Menu
      summary: Get shop menu with today's catalog
      description: |
        Retrieve shop details and catalog items available today.
        Returns shop information with all catalog items and their prices for today.
      operationId: getShopMenu
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          example: "6958fbaac7c72a28f87b07ef"
      responses:
        '200':
          description: Shop menu retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ShopMenuDTO'
              example:
                shopId: "6958fbaac7c72a28f87b07ef"
                shopName: "Pizza Palace"
                location: "123 Main St, New York, NY"
                catalogs:
                  - id: "60d5ec49c1234567890abcde"
                    name: "Margherita Pizza"
                    category: "Pizza"
                    shopId: "6958fbaac7c72a28f87b07ef"
                    unit: "Per Piece"
                    price:
                      currency: "INR"
                      value: 350
                    availability:
                      startTime: "11:00"
                      endTime: "23:00"
                      available: true
        '404':
          description: Shop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops/{id}/generate-qr:
    post:
      tags:
        - Shop-QR
      summary: Generate QR code for shop menu
      description: |
        Generate a QR code linking to the shop's menu page.
        QR code is stored in the shop collection.
      operationId: generateQRCode
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          example: "6958fbaac7c72a28f87b07ef"
      responses:
        '200':
          description: QR code generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "QR code generated successfully"
                  qrCode:
                    type: string
                    description: Base64 encoded QR code image
                  qrCodeUrl:
                    type: string
                    example: "https://myshop.soanch.com/web-menu?shopid=6958fbaac7c72a28f87b07ef"
        '404':
          description: Shop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops/{id}/qr-code:
    get:
      tags:
        - Shop-QR
      summary: Get stored QR code for shop
      description: Retrieve the previously generated QR code for a shop
      operationId: getQRCode
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          example: "6958fbaac7c72a28f87b07ef"
      responses:
        '200':
          description: QR code retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  qrCode:
                    type: string
                    description: Base64 encoded QR code image
                  qrCodeUrl:
                    type: string
        '404':
          description: Shop or QR code not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/shops/search/name:
    get:
      tags:
        - Shop
      summary: Search shops by name
      operationId: getShopsByName
      parameters:
        - in: query
          name: name
          required: true
          schema:
            type: string
          example: "Pizza"
      responses:
        '200':
          description: List of shops matching the name
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Shop'

  /api/shops/search/owner:
    get:
      tags:
        - Shop
      summary: Search shops by owner
      operationId: getShopsByOwner
      parameters:
        - in: query
          name: owner
          required: true
          schema:
            type: string
          example: "John Doe"
      responses:
        '200':
          description: List of shops by owner
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Shop'

  /api/shops/search/address:
    get:
      tags:
        - Shop
      summary: Search shops by address
      operationId: getShopsByAddress
      parameters:
        - in: query
          name: address
          required: true
          schema:
            type: string
          example: "New York"
      responses:
        '200':
          description: List of shops in the address
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Shop'

  /api/catalogs:
    post:
      tags:
        - Catalog
      summary: Create a new catalog item
      description: Create a new catalog item (Requires Private Token)
      security:
        - BearerAuth: []
      operationId: createCatalog
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Catalog'
      responses:
        '201':
          description: Catalog item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/catalogs/{id}:
    get:
      tags:
        - Catalog
      summary: Get catalog item details
      operationId: getCatalogById
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Catalog item found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '404':
          description: Catalog item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Catalog
      summary: Update a catalog item
      description: Update catalog item details (Requires Private Token)
      security:
        - BearerAuth: []
      operationId: updateCatalog
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Catalog'
      responses:
        '200':
          description: Catalog item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Catalog'
        '404':
          description: Catalog item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Catalog
      summary: Delete a catalog item
      description: Delete a catalog item (Requires Private Token)
      security:
        - BearerAuth: []
      operationId: deleteCatalog
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Catalog item deleted successfully
        '404':
          description: Catalog item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/catalogs/search/shop/{shopId}:
    get:
      tags:
        - Catalog
      summary: Get catalog items by shop
      description: Retrieve all catalog items for a specific shop (Public endpoint)
      operationId: getCatalogsByShop
      parameters:
        - in: path
          name: shopId
          required: true
          schema:
            type: string
          example: "6958fbaac7c72a28f87b07ef"
      responses:
        '200':
          description: List of catalog items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Catalog'
        '404':
          description: Shop not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/catalogs/search/category:
    get:
      tags:
        - Catalog
      summary: Search catalogs by category
      operationId: getCatalogsByCategory
      parameters:
        - in: query
          name: category
          required: true
          schema:
            type: string
          example: "Vegetables"
      responses:
        '200':
          description: List of catalog items in category
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Catalog'

